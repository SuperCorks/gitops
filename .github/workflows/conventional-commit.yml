name: "Check PR Title Matches Conventional Commits"

on:
  pull_request:
    types: [opened, reopened, synchronize, edited]
    branches:
      - main
      - develop

jobs:
  validate-pr-title:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR Title
        uses: actions/github-script@v8
        with:
          script: |
            // Retrieve the PR title from the event payload
            const prTitle = context.payload.pull_request.title;

            // Define a regex for Conventional Commits.
            // This regex expects a title starting with a type (e.g., feat, fix, docs, etc.),
            // optionally followed by a scope in parentheses,
            // an optional bang "!" to indicate a breaking change,
            // then a colon, a space, and then a description.
            const regex = /^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([^\)]+\))?!?:\s.+/;

            if (!regex.test(prTitle)) {
              core.setFailed(`PR title "${prTitle}" does not follow the Conventional Commits format. Please use the format: type(optional scope)!: description. For more info, visit https://www.conventionalcommits.org/`);
            } else {
              console.log("PR title follows Conventional Commits format.");
            }
